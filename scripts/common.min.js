function onDeviceReady(){alert("deviceready");document.addEventListener("backbutton",onBackKeyDown,false)}function onBackKeyDown(e){alert("back button");e.preventDefault();alert($.mobile.activePage);alert(Store.isSet("user"));if($.mobile.activePage.is("#saleOrderSelectCustomer")||$.mobile.activePage.is("#login")||Store.isSet("user")===false){navigator.app.exitApp()}else{navigator.app.backHistory()}return false}function changeArea(){area=$("#area option:selected").text();if(area=="Area"){divisionData=Store.get("division."+Store.get("user").Userid)}else{var e=Store.get("customers."+Store.get("user").Userid);e=getObjects(e,"AreaName",area);divisionData=getDistinct(e,"DivisionName")}customers=Store.get("customers."+Store.get("user").Userid);if(area!="Area")customers=getObjects(customers,"AreaName",area);if(division!="Division")customers=getObjects(customers,"DivisionName",division,"exact");if(customerName!="")customers=getObjects(customers,"StoreName",customerName);app.loadPage();return false}function changeDivision(){division=$("#division option:selected").text();if(division=="Division"){areaData=Store.get("area."+Store.get("user").Userid)}else{var e=Store.get("customers."+Store.get("user").Userid);e=getObjects(e,"DivisionName",division);areaData=getDistinct(e,"AreaName")}customers=Store.get("customers."+Store.get("user").Userid);if(area!="Area")customers=getObjects(customers,"AreaName",area);if(division!="Division")customers=getObjects(customers,"DivisionName",division,"exact");if(customerName!="")customers=getObjects(customers,"StoreName",customerName);app.loadPage();return false}function searchCustomer(e){e.preventDefault();if($.trim($(this).val()).length==0){return false}customerName=$.trim($(this).val());customers=Store.get("customers."+Store.get("user").Userid);if(area!="Area")customers=getObjects(customers,"AreaName",area);if(division!="Division")customers=getObjects(customers,"DivisionName",division,"exact");customers=getObjects(customers,"StoreName",$(this).val());app.loadPage();return false}function refreshAppData(e){e.preventDefault();$("#sure .sure-1").text("Are You Sure?");$("#sure .sure-2").text("Are you sure refresh application data?");$("#sure").popup("open");$("#suredo").unbind("tap").bind("tap",function(){Store.clear("appData."+Store.get("user").Userid);Store.clear("customers."+Store.get("user").Userid);Store.clear("category."+Store.get("user").Userid);Store.clear("products."+Store.get("user").Userid);app.getAppData(closePopUp);return false});return false}function syncOrders(e){e.preventDefault();ordersSaved=0;ordersSynced=0;var t=Store.get("order."+Store.get("user").Userid);var n=getObjects(t,"savedStatus","false","exact");orderToSync=n.length;if(orderToSync){$.each(n,function(e,t){delete t["referenceNo"];delete t["savedStatus"];delete t["serialNo"];app.postData(t,"order",countSyncOrders)})}else{navigator.notification.alert("No Items to Sync",callBackFunc,"Notice")}return false}function countSyncOrders(e){ordersSynced++;if(e!=0)ordersSaved++;if(ordersSynced==orderToSync){navigator.notification.alert("Saved "+ordersSaved+" Orders",callBackFunc,"Notice")}}function closePopUp(){navigator.notification.alert("Done!!",callBackFunc,"Done");$.mobile.hidePageLoadingMsg();$("#sure").popup("close")}function unBindEvents(){$(".back").unbind("tap");$("#refreshAppData").off("tap");$("#syncOrders").off("tap");$("#searchCustomer").off("keyup",searchCustomer);$(".ui-collapsible").off("tap",collapse);$(".logout").unbind("tap",logout);$(".settings").unbind("tap");$(".drafts").unbind("tap");$("#btnCancel").unbind("tap");$(".home").unbind("tap");$(".closebutton").unbind("tap",navigate);$("#btnBack").unbind("tap",navigate);$(".viewOrder").unbind("tap",orders.viewOrder);$(".viewItem").unbind("tap",showViewPopUp);$(".addproduct").unbind("tap");$(".editItem").unbind("tap",showEditPopUp);$("#removeEntry").unbind("tap");$("#editEntry").unbind("tap");$("#btnSave").unbind("tap",orders.saveOrder);$("#btnFinish").unbind("tap",orders.finish);$("#btnAddNext").unbind("tap");$("#btnNextOrder").unbind("tap",navigate);$(".orders").unbind("tap",navigate);$("#category").unbind("change",orders.selectCategory);$("#product").unbind("keyup",orders.searchProduct)}function bindEvents(){$(".back").unbind("tap").bind("tap",{page:"#saleOrderSelectCustomer"},navigate);$("#refreshAppData").off("tap").on("tap",refreshAppData);$("#syncOrders").off("tap").on("tap",syncOrders);$("#searchCustomer").off("keyup",searchCustomer).on("keyup",searchCustomer);$(".ui-collapsible").off("tap",collapse).on("tap",collapse);$(".logout").unbind("tap",logout).bind("tap",logout);$(".settings").unbind("tap").bind("tap",{page:"#settings"},navigate);$(".drafts").unbind("tap").bind("tap",{page:"#drafts"},navigate);$("#btnCancel").unbind("tap").bind("tap",{page:"#saleOrderSelectCustomer"},navigate);$(".home").unbind("tap").bind("tap",{page:"#saleOrderSelectCustomer"},navigate);$(".closebutton").unbind("tap",navigate).bind("tap",{page:"#saleOrderSelectCustomer"},navigate);$("#btnBack").unbind("tap",navigate).bind("tap",{page:"#saleOrderEntry"},navigate);$(".viewOrder").unbind("tap",orders.viewOrder).bind("tap",orders.viewOrder);if(editMode){$(".viewItem").unbind("tap",showViewPopUp);$(".addproduct").unbind("tap").bind("tap",{page:"#enterProducts"},orders.addProduct);$(".editItem").unbind("tap",showEditPopUp).bind("tap",showEditPopUp);$("#removeEntry").unbind("tap").bind("tap",orders.removeItem);$("#editEntry").unbind("tap").bind("tap",orders.addProduct);$("#btnSave").unbind("tap",orders.saveOrder).bind("tap",orders.saveOrder)}else{$(".addproduct").unbind("tap");$(".editItem").unbind("tap",showEditPopUp);$(".viewItem").unbind("tap",showViewPopUp).bind("tap",showViewPopUp);$("#btnSave").unbind("tap",orders.saveOrder);$("#viewEntry").unbind("tap").bind("tap",orders.addProduct)}$("#btnFinish").unbind("tap",orders.finish).bind("tap",orders.finish);$("#btnAddNext").unbind("tap").bind("tap",orders.addItem);$("#btnNextOrder").unbind("tap",navigate).bind("tap",{page:"#saleOrderSelectCustomer"},navigate);$(".orders").unbind("tap",navigate).bind("tap",{page:"#saleOrders"},navigate);$("#category").unbind("change",orders.selectCategory).bind("change",orders.selectCategory);$("#product").unbind("keyup",orders.searchProduct).bind("keyup",orders.searchProduct)}function logout(e){e.preventDefault();Store.clear("user");$.mobile.changePage("#login",{transition:"slide",reverse:false,changeHash:false});return false}function showEditPopUp(e){e.preventDefault();$("#editItem").find(".ui-first-child").html($(this).find(".productName").html());$("#editItem").find(".productId").val($(this).find(".productId").val());$("#editItem").popup("open");return false}function showViewPopUp(e){e.preventDefault();$("#viewItem").find(".ui-first-child").html($(this).find(".productName").html());$("#viewItem").find(".productId").val($(this).find(".productId").val());$("#viewItem").popup("open");return false}function onResize(){var e=25;var t;var n;if(window.orientation===0||window.orientation===180){potraitScreenHeight=$(window).height();n=$(window).width()}else{t=$(window).width();n=$(window).height()}if((window.orientation===0||window.orientation===180)&&window.innerHeight+e<t){$("[data-role=footer]").removeAttr("data-position")}else if(window.innerHeight+e<n){$("[data-role=footer]").removeAttr("data-position")}else{$("[data-role=footer]").attr("data-position","fixed")}$("#searchResults").height($(window).height()-$("#searchResults").offset().top-$("#footer").height()-17);$(".ui-link-inherit").width($(window).width()-100)}function navigate(e){e.preventDefault();$.mobile.showPageLoadingMsg();var t=e.data.transition===undefined?"slide":e.data.transition;var n=e.data.hash===undefined?true:e.data.hash;var r=e.data.reverse===undefined?false:e.data.reverse;$.mobile.changePage(e.data.page,{transition:t,changeHash:n,reverse:r});$.mobile.hidePageLoadingMsg();return false}function collapse(e){e.preventDefault();if($(this).hasClass("ui-collapsible-collapsed")){$(this).removeClass("ui-collapsible-collapsed");$(this).find("span.ui-icon").removeClass("ui-icon-plus");$(this).find("span.ui-icon").addClass("ui-icon-minus");$(this).children("div.ui-collapsible-content").removeClass("ui-collapsible-content-collapsed")}else{$(this).addClass("ui-collapsible-collapsed");$(this).find("span.ui-icon").removeClass("ui-icon-minus");$(this).find("span.ui-icon").addClass("ui-icon-plus");$(this).children("div.ui-collapsible-content").addClass("ui-collapsible-content-collapsed")}return false}var url;var stayloggedin=0;var editMode=true;var ordersSaved=0;var orderToSync=0;var ordersSynced=0;var customers;var area="Area";var division="Division";var customerName="";var areaData;var divisionData;$(document).bind("mobileinit",function(){$.mobile.touchOverflowEnabled=true;$.mobile.defaultPageTransition="none";$.mobile.defaultDialogTransition="none";$.mobile.loadingMessageTextVisible=true;$.mobile.buttonMarkup.hoverDelay=30});$(document).on("pagebeforeshow","#saleOrderSelectCustomer",function(){url="http://www.getmyorder.in/index.php/ajax/";if(!Store.isSet("user")){$.mobile.changePage("#login",{transition:"slide",changeHash:false,reverse:false});return false}bindEvents()});$(document).delegate("#saleOrderSelectCustomer","pageinit",function(){$("#area").closest(".ui-select").width($(window).width()-76);$("#division").closest(".ui-select").width($(window).width()-76);url="http://www.getmyorder.in/index.php/ajax/";if(!Store.isSet("user")){$.mobile.changePage("#login",{transition:"slide",changeHash:false,reverse:false});return false}onResize();$(window).off("resize").on("resize",onResize);app.initialize();bindEvents();return false}).delegate("#saleOrderSelectCustomer","pageshow",function(){onResize();$(window).off("resize").on("resize",onResize);return false}).delegate("#saleOrderEntry","pageshow",function(){var e;var t;var n=0;var r=0;if(editMode){var i=getObject(orders.pendingOrders,"selectedOrder",true);e=orders.pendingOrders[i].items}else{e=orders.savedOrders.items}$("#ui-items").children(".added").remove();$.each(e,function(e,i){n++;node=$(".template",$("#ui-items")).clone().removeClass("template");$(".productName",node).html(i.productName);$(".category",node).html(i.category);if(i.offerquantity==0||i.offerquantity==""){t=" Qty: "+i.quantity}else{t=" Qty: "+i.quantity+"/"+i.offerquantity}r+=parseFloat(i.unitprice)*parseFloat(i.quantity);$(".quantity",node).html(t);$(".productId",node).val(i.productId);$(".unitprice",node).html("Price: "+i.unitprice);$(node).addClass("added");$(node).appendTo("#ui-items")});$(".noItems").text(n+" item(s) ");$(".total").text(" Rs"+r.toFixed(2));bindEvents();return false}).delegate("#saleOrders","pageshow",function(){var e=Store.get("order."+Store.get("user").Userid);var t=0;var n=0;var r=0;var i=0;var s=Date.now();var o,u,a;$("#ui-orders").children(".added").remove();if(e){$.each(e,function(e,f){t++;if(Math.abs((s-f.date)/(60*60*24*1e3)).toFixed(0)==0){n++}if(f.savedStatus){r++;i=f.referenceNo}else{i=""}u=f.storeName.split("-");o=f.storeName;a=f.storeName;if(typeof u[0]!="undefined"){o=$.trim(u[0])}if(typeof u[1]!="undefined"){a=$.trim(u[1])}node=$(".template",$("#ui-orders")).clone().removeClass("template");$(".orderno",node).html("Order No : "+i);$(".storeName",node).html(o);$(".storeCode",node).html(f.storeCode);$(".location",node).html(a);$(".areaName",node).html(f.areaName);$(".divisionName",node).html(f.divisionName);$(".storeId",node).val(f.storeId);$(".areaId",node).val(f.areaId);$(".divisionId",node).val(f.divisionId);$(".divisionCode",node).val(f.divisionCode);$(".serialNo",node).val(f.serialNo);$(node).addClass("added");$(node).appendTo("#ui-orders")})}$("#totalOrders").html("Total Orders : "+t);$("#todaysOrders").html("Todays Orders : "+n);bindEvents();return false}).delegate("#login","pageshow",function(){$("#btnLogin").unbind("tap",login).bind("tap",login);$("input[type='radio']").bind("change",function(e){if($("on").attr("checked")=="checked"){stayloggedin=0}else{stayloggedin=18e3}});return false}).delegate("#drafts","pageshow",function(){draftorders=orders.pendingOrders;var e,t,n,r;$("#ui-drafts").children(".added").remove();$.each(draftorders,function(t,n){e=$(".template",$("#ui-drafts")).clone().removeClass("template");$(".storeName",e).html(n.storeName);$(".storeCode",e).html(n.storeCode);$(".location",e).html(n.location);$(".storeId",e).val(n.storeId);$(".divisionId",e).val(n.DivisionId);$(".divisionCode",e).val(n.divisionCode);$(".divisionName",e).html(n.divisionName);$(".areaName",e).html(n.areaName);$(".areaId",e).val(n.AreaId);$(e).addClass("added");$(e).appendTo("#ui-drafts");$("#ui-results").show()});$(".customer").unbind("tap",orders.selectCustomer);$(".customer").bind("tap",{page:"#saleOrderEntry"},orders.selectCustomer);return false}).delegate("#settings","pageshow",function(){return false}).delegate("#savedOrder","pageshow",function(){$("#btnExit").off("tap").on("tap",function(e){e.preventDefault();try{navigator.app.exitApp();navigator.device.exitApp()}catch(t){}});return false}).delegate("#enterProducts","pageshow",function(){$("#category").closest(".ui-select").width($(window).width()-30);var e=Store.get("category."+Store.get("user").Userid);$("#category").html("");$("<option>Category</option>").appendTo("#category");$.each(e,function(e,t){$("<option>"+t+"</option>").appendTo("#category")});$("#category").val(categorySelected).change();if(editMode){$("#btnBack").closest("div").hide();$("#btnAddNext").closest("div").show();$("#btnFinish").closest("div").show()}else{$("#btnBack").closest("div").show();$("#btnAddNext").closest("div").hide();$("#btnFinish").closest("div").hide()}bindEvents();return false})
